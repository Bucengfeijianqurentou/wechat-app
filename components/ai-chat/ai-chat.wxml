<van-popup
  show="{{ show }}"
  position="bottom"
  round
  custom-style="height: 100vh;"
  bind:close="onClose"
  safe-area-inset-bottom
  overlay="{{ true }}"
>
  <view class="chat-container">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <view class="chat-header">
      <view class="title">
        <text class="icon">ğŸ¤–</text>
        <text>AIåŠ©æ‰‹</text>
      </view>
      <van-icon name="cross" bind:tap="onClose" />
    </view>

    <!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
    <scroll-view 
      scroll-y 
      class="chat-content"
      scroll-into-view="msg-{{messages.length-1}}"
      scroll-with-animation
      enhanced
      show-scrollbar="{{false}}"
    >
      <block wx:for="{{ messages }}" wx:key="index">
        <view class="message {{item.type}}" id="msg-{{index}}">
          <view class="avatar" wx:if="{{item.type === 'ai'}}">ğŸ¤–</view>
          <view class="avatar" wx:if="{{item.type === 'user'}}">ğŸ‘¤</view>
          <view class="content">
            <text user-select>{{item.content}}</text>
            <view class="typing-indicator" wx:if="{{item.isTyping}}">
              <view class="dot"></view>
              <view class="dot"></view>
              <view class="dot"></view>
            </view>
          </view>
        </view>
      </block>

      <!-- é¢„è®¾é—®é¢˜åŒºåŸŸ -->
      <view class="preset-questions" wx:if="{{showPresetQuestions}}">
        <view 
          class="question-item" 
          wx:for="{{presetQuestions}}" 
          wx:key="index"
          bind:tap="onQuestionTap"
          data-question="{{item}}"
        >
          {{item}}
        </view>
      </view>
    </scroll-view>

    <!-- åº•éƒ¨è¾“å…¥åŒºåŸŸ -->
    <view class="chat-footer">
      <view class="input-wrapper">
        <input
          class="chat-input"
          value="{{ inputValue }}"
          placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..."
          confirm-type="send"
          bindconfirm="onSend"
          bindinput="onInputChange"
          adjust-position="{{false}}"
        />
        <van-button 
          size="small" 
          type="primary" 
          bind:tap="onSend"
          custom-class="send-button"
        >å‘é€</van-button>
      </view>
    </view>
  </view>
</van-popup> 